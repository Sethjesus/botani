<!DOCTYPE html>
<html>
<head>
    <title>設備能耗趨勢圖</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f9f9f9; }
        .container { margin: 20px; padding: 20px; text-align: center; }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .grid-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
            border-radius: 8px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }
        .alert { 
            color: red; font-weight: bold; background-color: rgba(255, 0, 0, 0.1); 
            padding: 5px; border-radius: 5px; margin-top: 10px; 
        }
        .threshold { font-size: 18px; font-weight: bold; }
        input[type="number"], input[type="range"] { width: 120px; margin-left: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="color: #2C3E50;">📊 設備能耗趨勢圖</h2>
        <h4 class="threshold">🛠 選擇設備並設定警戒閾值：</h4>
        <div id="threshold-container" class="grid-container"></div>
        <div id="chart" style="height: 500px;"></div>
        <div id="alert-container"></div>
    </div>
    <script>
        let devices = JSON.parse(`{
    "3F-1650L乳化機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.407
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 1.053
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "3F-1650L乳化機",
            "能耗 (kWh)": 0.0
        }
    ],
    "3F-1CP型攪拌機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "3F-1CP型攪拌機",
            "能耗 (kWh)": 0.0
        }
    ],
    "3F-1軟管充填密封機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.146
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "3F-1軟管充填密封機",
            "能耗 (kWh)": 0.0
        }
    ],
    "3F-1雙頭面膜充填機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.237
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 1.707
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "3F-1雙頭面膜充填機",
            "能耗 (kWh)": 0.0
        }
    ],
    "4F-1凍乾機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.34
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 9.462
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1凍乾機",
            "能耗 (kWh)": 0.0
        }
    ],
    "4F-1半自動軟管充填密封機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 4.542
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.253
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.668
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1半自動軟管充填密封機",
            "能耗 (kWh)": 0.085
        }
    ],
    "4F-1手動充填機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.003
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.186
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.001
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.004
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.003
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1手動充填機",
            "能耗 (kWh)": 0.0
        }
    ],
    "4F-1打標機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.416
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.333
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.441
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.47
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.417
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.468
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.005
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.427
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.451
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.046
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1打標機",
            "能耗 (kWh)": 0.179
        }
    ],
    "4F-1烘膜機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1烘膜機",
            "能耗 (kWh)": 0.0
        }
    ],
    "4F-1真空乳化攪拌裝置250L": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 1.978
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 2.088
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.258
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.303
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.995
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 2.482
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 1.252
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 1.283
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1真空乳化攪拌裝置250L",
            "能耗 (kWh)": 1.079
        }
    ],
    "4F-1真空乳化攪拌裝置50L": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.001
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 1.089
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.141
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.001
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.695
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1真空乳化攪拌裝置50L",
            "能耗 (kWh)": 0.437
        }
    ],
    "4F-1萃取槽": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.02
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 1.129
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 1.545
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 1.512
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1萃取槽",
            "能耗 (kWh)": 1.189
        }
    ],
    "4F-1電器室": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 0.184
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 89.23
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 101.421
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 66.315
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 107.707
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 141.697
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 159.35
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 71.737
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 75.126
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 76.455
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 98.338
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 92.679
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 104.786
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 116.509
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 72.181
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1電器室",
            "能耗 (kWh)": 101.939
        }
    ],
    "4F-1面膜袋封膜機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-1面膜袋封膜機",
            "能耗 (kWh)": 0.0
        }
    ],
    "4F-2乾燥室": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 19.486
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 22.818
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 18.947
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 18.182
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 14.989
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 18.101
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 5.388
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 19.545
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-2乾燥室",
            "能耗 (kWh)": 17.359
        }
    ],
    "4F-2充填機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-2充填機",
            "能耗 (kWh)": 0.0
        }
    ],
    "4F-2半自動軟管封尾機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-2半自動軟管封尾機",
            "能耗 (kWh)": 0.0
        }
    ],
    "4F-2打標機": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-2打標機",
            "能耗 (kWh)": 0.0
        }
    ],
    "4F-2真空乳化攪拌裝置": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-2真空乳化攪拌裝置",
            "能耗 (kWh)": 0.0
        }
    ],
    "4F-2電器室": [
        {
            "日期": "2025-07-07",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 270.369
        },
        {
            "日期": "2025-07-08",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 492.939
        },
        {
            "日期": "2025-07-09",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 645.259
        },
        {
            "日期": "2025-07-10",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 786.866
        },
        {
            "日期": "2025-07-11",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 790.934
        },
        {
            "日期": "2025-07-12",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 495.884
        },
        {
            "日期": "2025-07-13",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 265.156
        },
        {
            "日期": "2025-07-14",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 635.04
        },
        {
            "日期": "2025-07-15",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 714.887
        },
        {
            "日期": "2025-07-16",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 540.922
        },
        {
            "日期": "2025-07-17",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 461.504
        },
        {
            "日期": "2025-07-18",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 509.713
        },
        {
            "日期": "2025-07-19",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 402.114
        },
        {
            "日期": "2025-07-20",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 244.364
        },
        {
            "日期": "2025-07-21",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 641.067
        },
        {
            "日期": "2025-07-22",
            "設備名稱": "4F-2電器室",
            "能耗 (kWh)": 838.156
        }
    ]
}`);

        console.log("設備數據:", devices);

        if (!devices || Object.keys(devices).length === 0) {
            document.getElementById("threshold-container").innerHTML = "<p style='color:red;'>⚠️ 沒有可用的設備數據，請檢查數據來源！</p>";
        }

        const thresholdContainer = document.getElementById("threshold-container");
        const alertContainer = document.getElementById("alert-container");
        const chartDiv = document.getElementById("chart");

        let layout = {
            title: '📈 每日設備能耗趨勢圖 (單位: kWh)',
            xaxis: { title: '📅 日期', tickangle: -45 },
            yaxis: { title: '🔋 用電量 (kWh)' },
            paper_bgcolor: '#ffffff',
            plot_bgcolor: '#eef2f7',
            font: { family: "Arial", size: 14, color: "#333333" },
        };

        const colors = ['#FF5733', '#33FF57', '#5733FF', '#FFD700', '#FF33A1', '#A133FF', '#33A1FF', '#FF8C33', '#33FFA1', '#A1FF33'];

        // 創建設備選擇區
        for (let device in devices) {
            const deviceContainer = document.createElement("div");
            deviceContainer.classList.add("grid-item");
            deviceContainer.innerHTML = `
                <input type="checkbox" id="toggle-${device}">
                <label for="toggle-${device}">${device}</label>
                <input type="number" id="threshold-${device}" value="1200" min="0" max="2000" step="1" oninput="syncSlider('${device}')">
                <input type="range" id="slider-${device}" value="1200" min="0" max="2000" step="1" oninput="syncNumber('${device}')">
            `;
            thresholdContainer.appendChild(deviceContainer);
        }

        function syncSlider(device) {
            document.getElementById("slider-" + device).value = document.getElementById("threshold-" + device).value;
            updateChart();
        }

        function syncNumber(device) {
            document.getElementById("threshold-" + device).value = document.getElementById("slider-" + device).value;
            updateChart();
        }

        function updateChart() {
            let traces = [];
            let colorIndex = 0;

            for (let device in devices) {
                const checkbox = document.getElementById("toggle-" + device);
                const numberInput = document.getElementById("threshold-" + device);

                if (checkbox.checked) {
                    let data = devices[device];

                    traces.push({
                        x: data.map(d => d["日期"]),
                        y: data.map(d => d["能耗 (kWh)"]),
                        mode: 'lines',
                        name: device,
                        line: { color: colors[colorIndex % colors.length], width: 3, shape: 'spline' }
                    });

                    let threshold = parseFloat(numberInput.value);
                    traces.push({
                        x: data.map(d => d["日期"]),
                        y: Array(data.length).fill(threshold),
                        mode: 'lines',
                        name: device + " 警戒線",
                        line: { color: colors[colorIndex % colors.length], dash: 'dot', width: 2 }
                    });   

                    colorIndex++;
                }
            }

            Plotly.newPlot(chartDiv, traces, layout);
        }

        updateChart();
    </script>
</body>
</html>